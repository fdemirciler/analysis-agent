<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fin-Botics | AI Financial Analyst</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Add dark mode support to Tailwind
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a cleaner look */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        .chat-messages::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .chat-messages::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        /* Dark mode scrollbar */
        .dark .chat-messages::-webkit-scrollbar-track {
            background: #1e293b;
        }
        .dark .chat-messages::-webkit-scrollbar-thumb {
            background: #475569;
        }
        .dark .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        /* Animation for chat messages */
        .message-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<!-- Body now controls the overall background and stretches to fill the screen -->
<body class="bg-white dark:bg-slate-900 flex flex-col min-h-screen transition-colors duration-300">

    <!-- Main chat container takes full width and height, no max-width, minimal shadow -->
    <div class="w-full flex-1 bg-white dark:bg-slate-800 rounded-none shadow-none flex flex-col">
        
        <!-- Header - Simplified to match reference, removed icon, kept theme toggle -->
        <header class="border-b border-slate-200 dark:border-slate-700 p-4 sm:p-6 flex items-center justify-between max-w-2xl mx-auto w-full">
            <div class="flex items-center gap-3">
                <!-- Chatbot icon similar to the reference image (abstract chat bubble) -->
                <div class="bg-blue-500 p-2 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 11c0 .55-.45 1-1 1s-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v3zm4 0c0 .55-.45 1-1 1s-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v3zm4 0c0 .55-.45 1-1 1s-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v3z"/>
                    </svg>
                </div>
                <h1 class="text-xl font-bold text-slate-800 dark:text-slate-100">Fin-Botics</h1>
            </div>
            <div class="flex items-center gap-4">
                <!-- Theme Toggle Button - Kept as it's a useful feature, though not in reference -->
                <button id="theme-toggle" class="text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full p-2 transition-colors duration-200">
                    <!-- Light Mode Icon -->
                    <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    <!-- Dark Mode Icon (hidden by default) -->
                    <svg id="theme-icon-dark" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Content Area - Now has max-width and auto margins for centering -->
        <main class="flex-1 flex flex-col p-4 sm:p-6 overflow-hidden max-w-2xl mx-auto w-full">
            
            <!-- Chat Messages Display Area -->
            <div id="chat-messages" class="chat-messages flex-1 space-y-6 overflow-y-auto pr-2">
                <!-- Initial Bot Message -->
                <div class="message-fade-in flex items-start gap-3">
                    <div class="bg-slate-200 dark:bg-slate-700 p-2 rounded-full">
                        <!-- Bot Avatar Icon - Updated to the provided sparkle star SVG -->
                        <svg height="14" stroke-linejoin="round" viewBox="0 0 16 16" width="14" class="h-5 w-5 text-slate-600 dark:text-slate-300" fill="currentColor">
                            <path d="M2.5 0.5V0H3.5V0.5C3.5 1.60457 4.39543 2.5 5.5 2.5H6V3V3.5H5.5C4.39543 3.5 3.5 4.39543 3.5 5.5V6H3H2.5V5.5C2.5 4.39543 1.60457 3.5 0.5 3.5H0V3V2.5H0.5C1.60457 2.5 2.5 1.60457 2.5 0.5Z" fill="currentColor"></path>
                            <path d="M14.5 4.5V5H13.5V4.5C13.5 3.94772 13.0523 3.5 12.5 3.5H12V3V2.5H12.5C13.0523 2.5 13.5 2.05228 13.5 1.5V1H14H14.5V1.5C14.5 2.05228 14.9477 2.5 15.5 2.5H16V3V3.5H15.5C14.9477 3.5 14.5 3.94772 14.5 4.5Z" fill="currentColor"></path>
                            <path d="M8.40706 4.92939L8.5 4H9.5L9.59294 4.92939C9.82973 7.29734 11.7027 9.17027 14.0706 9.40706L15 9.5V10.5L14.0706 10.5929C11.7027 10.8297 9.82973 12.7027 9.59294 15.0706L9.5 16H8.5L8.40706 15.0706C8.17027 12.7027 6.29734 10.8297 3.92939 10.5929L3 10.5V9.5L3.92939 9.40706C6.29734 9.17027 8.17027 7.29734 8.40706 4.92939Z" fill="currentColor"></path>
                        </svg>
                    </div>
                    <!-- Message bubbles with less rounded corners -->
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg max-w-md">
                        <p class="text-sm text-slate-700 dark:text-slate-200">
                            Hello! I'm Fin-Botics, your AI financial analyst. Please upload your financial data in CSV or Excel format to get started.
                        </p>
                    </div>
                </div>
            </div>

            <!-- File Upload Section -->
            <section id="file-upload-section" class="mt-6">
                <label for="file-upload" class="cursor-pointer">
                    <div id="drop-zone" class="border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl p-6 text-center transition-colors duration-300 hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-slate-700/50">
                        <div class="flex flex-col items-center text-slate-500 dark:text-slate-400">
                            <!-- Upload Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            <p class="font-semibold">Drag & drop your file here</p>
                            <p class="text-sm mt-1">or <span class="text-blue-500 dark:text-blue-400 font-medium">click to browse</span></p>
                            <p class="text-xs text-slate-400 dark:text-slate-500 mt-2">Supports: CSV, XLS, XLSX</p>
                        </div>
                    </div>
                </label>
                <input type="file" id="file-upload" class="hidden" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">
            </section>

            <!-- Chat Input Area -->
            <div id="chat-input-area" class="mt-6 hidden">
                <div class="flex items-center gap-2"> <!-- Reduced gap -->
                    <input type="text" id="user-input" placeholder="Ask a question about your data..." class="flex-1 w-full px-4 py-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 text-slate-800 dark:text-slate-100 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow duration-300">
                    <!-- Send Button - Circular with paper plane icon -->
                    <button id="send-button" class="bg-blue-500 text-white p-3 rounded-full h-12 w-12 flex items-center justify-center hover:bg-blue-600 transition-colors duration-300 disabled:bg-slate-300 dark:disabled:bg-slate-600 disabled:cursor-not-allowed">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transform rotate-90" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                        </svg>
                    </button>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- DOM Element References ---
        const dropZone = document.getElementById('drop-zone');
        const fileUploadInput = document.getElementById('file-upload');
        const fileUploadSection = document.getElementById('file-upload-section');
        const chatInputArea = document.getElementById('chat-input-area');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const chatMessages = document.getElementById('chat-messages');
        const themeToggle = document.getElementById('theme-toggle');
        const themeIconLight = document.getElementById('theme-icon-light');
        const themeIconDark = document.getElementById('theme-icon-dark');

        const allowedFileTypes = [
            'text/csv',
            'application/vnd.ms-excel',
            'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
        ];
        
        // --- Theme Management ---
        /**
         * Applies the specified theme (dark or light) to the document.
         * @param {string} theme - The theme to apply ('dark' or 'light').
         */
        const applyTheme = (theme) => {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                themeIconLight.classList.add('hidden');
                themeIconDark.classList.remove('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                themeIconLight.classList.remove('hidden');
                themeIconDark.classList.add('hidden');
            }
        };

        // Event listener for theme toggle button
        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            const newTheme = isDark ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme); // Save theme preference
            applyTheme(newTheme);
        });

        // Check for saved theme preference or system preference on load
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const initialTheme = savedTheme || (prefersDark ? 'dark' : 'light');
        applyTheme(initialTheme);


        // --- Event Listeners ---

        // Drag and Drop Listeners
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault(); // Prevent default to allow drop
            dropZone.classList.add('border-blue-500', 'bg-blue-50', 'dark:bg-slate-700/50');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('border-blue-500', 'bg-blue-50', 'dark:bg-slate-700/50');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-blue-500', 'bg-blue-50', 'dark:bg-slate-700/50');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });

        // Click to Upload Listener (triggered when file input changes)
        fileUploadInput.addEventListener('change', () => {
            if (fileUploadInput.files.length > 0) {
                handleFileUpload(fileUploadInput.files[0]);
            }
        });
        
        // Send Message Listeners (click on send button or press Enter in input)
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });


        // --- Core Functions ---

        /**
         * Handles the file upload process, validates the file, and updates the UI.
         * @param {File} file The file uploaded by the user.
         */
        function handleFileUpload(file) {
            if (!file) return; // Exit if no file is provided

            // Check if the file type is allowed
            if (!allowedFileTypes.includes(file.type)) {
                addBotMessage('Error: Invalid file type. Please upload a CSV or Excel file.', 'error');
                return;
            }

            // Display success message and enable chat input
            const successMessage = `Successfully uploaded "${file.name}". You can now ask questions about the data.`;
            addBotMessage(successMessage, 'success');
            
            // Hide file upload section and show chat input area
            fileUploadSection.classList.add('hidden');
            chatInputArea.classList.remove('hidden');
            userInput.disabled = false; // Enable user input field
            userInput.focus(); // Focus on the input field
        }

        /**
         * Handles sending a user message and triggering a bot response.
         */
        function sendMessage() {
            const messageText = userInput.value.trim();
            if (messageText === '') return; // Don't send empty messages

            addUserMessage(messageText); // Add user's message to chat
            userInput.value = ''; // Clear the input field
            
            // Simulate a bot response after a short delay
            setTimeout(simulateBotResponse, 1000);
        }
        
        /**
         * Simulates a response from the chatbot.
         * In a real application, this would involve an API call to a backend LLM.
         */
        function simulateBotResponse() {
            const responses = [
                "Based on the data, the total revenue for the last quarter was $1.2M, a 15% increase year-over-year.",
                "The analysis shows that the 'Software' category is the highest-performing product line, contributing to 45% of total sales.",
                "I've identified a downward trend in customer acquisition costs over the past three months, which is a positive sign.",
                "The gross profit margin has remained stable at 62%. Would you like a detailed breakdown by region?"
            ];
            // Select a random response from the predefined list
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            addBotMessage(randomResponse); // Add bot's message to chat
        }

        // --- UI Helper Functions ---

        /**
         * Adds a message from the user to the chat window.
         * @param {string} text The user's message.
         */
        function addUserMessage(text) {
            const messageHtml = `
                <div class="message-fade-in flex items-start gap-3 justify-end">
                    <div class="bg-blue-500 text-white p-4 rounded-lg max-w-md">
                        <p class="text-sm">${text}</p>
                    </div>
                </div>
            `;
            chatMessages.innerHTML += messageHtml; // Append message to chat
            scrollToBottom(); // Scroll to the latest message
        }

        /**
         * Adds a message from the bot to the chat window.
         * @param {string} text The bot's message.
         * @param {string} type The type of message ('info', 'success', 'error').
         */
        function addBotMessage(text, type = 'info') {
            let iconSvg;
            let bgColor;
            
            // Determine icon and background color based on message type
            switch(type) {
                case 'success':
                    iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600 dark:text-green-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`;
                    bgColor = 'bg-green-100 dark:bg-green-900/30';
                    break;
                case 'error': // Added error type handling
                    iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-600 dark:text-red-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>`;
                    bgColor = 'bg-red-100 dark:bg-red-900/30';
                    break;
                default: // Default info type
                    // Updated bot avatar icon to the provided sparkle star SVG
                    iconSvg = `<svg height="14" stroke-linejoin="round" viewBox="0 0 16 16" width="14" class="h-5 w-5 text-slate-600 dark:text-slate-300" fill="currentColor">
                                <path d="M2.5 0.5V0H3.5V0.5C3.5 1.60457 4.39543 2.5 5.5 2.5H6V3V3.5H5.5C4.39543 3.5 3.5 4.39543 3.5 5.5V6H3H2.5V5.5C2.5 4.39543 1.60457 3.5 0.5 3.5H0V3V2.5H0.5C1.60457 2.5 2.5 1.60457 2.5 0.5Z" fill="currentColor"></path>
                                <path d="M14.5 4.5V5H13.5V4.5C13.5 3.94772 13.0523 3.5 12.5 3.5H12V3V2.5H12.5C13.0523 2.5 13.5 2.05228 13.5 1.5V1H14H14.5V1.5C14.5 2.05228 14.9477 2.5 15.5 2.5H16V3V3.5H15.5C14.9477 3.5 14.5 3.94772 14.5 4.5Z" fill="currentColor"></path>
                                <path d="M8.40706 4.92939L8.5 4H9.5L9.59294 4.92939C9.82973 7.29734 11.7027 9.17027 14.0706 9.40706L15 9.5V10.5L14.0706 10.5929C11.7027 10.8297 9.82973 12.7027 9.59294 15.0706L9.5 16H8.5L8.40706 15.0706C8.17027 12.7027 6.29734 10.8297 3.92939 10.5929L3 10.5V9.5L3.92939 9.40706C6.29734 9.17027 8.17027 7.29734 8.40706 4.92939Z" fill="currentColor"></path>
                            </svg>`;
                    bgColor = 'bg-slate-100 dark:bg-slate-700';
            }

            const messageHtml = `
                <div class="message-fade-in flex items-start gap-3">
                    <div class="bg-slate-200 dark:bg-slate-600 p-2 rounded-full">${iconSvg}</div>
                    <div class="${bgColor} p-4 rounded-lg max-w-md">
                        <p class="text-sm text-slate-700 dark:text-slate-200">${text}</p>
                    </div>
                </div>
            `;
            chatMessages.innerHTML += messageHtml; // Append message to chat
            scrollToBottom(); // Scroll to the latest message
        }

        /**
         * Scrolls the chat window to the most recent message.
         */
        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>
</body>
</html>
